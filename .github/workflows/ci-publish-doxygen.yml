name: Deploy Doxygen Docs
on:
    push:
        branches:
            - main

permissions:
    id-token: write # Required for requesting the OIDC JWT
    contents: read # Required for actions/checkout
    pages: write

jobs:
    build:
        strategy:
            fail-fast: false
            matrix:
                build_type: [Debug]
        name: Build Doxygen
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - name: create build dir
              run: mkdir build
            - name: Install dependencies
              run: sudo apt-get install doxygen graphviz -y
            - name: cmake generator
              run: |
                  cmake -DCMAKE_BUILD_TYPE=${{ matrix.build_type }} -DBUILD_DOXYGEN=ON ..
              working-directory: build
            - name: cmake build
              run: |
                  cmake --build . --target doxygen --config=${{ matrix.build_type }} -j4
              working-directory: build
            - name: Upload artifact documentation
              id: deployment
              uses: actions/upload-pages-artifact@v3
              with:
                  path: build/doxygen/doxygen/html
    # Deployment job
    deploy:
        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-latest
        needs: build
        steps:
            - name: Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
